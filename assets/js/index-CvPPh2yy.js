(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();const V=typeof window<"u"&&(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.hostname==="0.0.0.0"||window.location.hostname==="[::1]"),m={API_ENDPOINT:V?"./mini.json":"https://OofMini.github.io/Minis-Repo/mini.json",FALLBACK_ICON:"./apps/repo-icon.png",FEATURED_BUNDLE_ID:"com.spotify.client",SEARCH_DEBOUNCE:150,TOAST_DURATION:4e3,FETCH_TIMEOUT:1e4,CARD_POOL_SIZE:24,OVERSCAN_ROWS:3,CARD_ROW_HEIGHT:88,CARD_GAP:12,SW_UPDATE_INTERVAL:1800*1e3,MAX_RECENT_SEARCHES:5,IDB_NAME:"minis-repo",IDB_VERSION:1,SPRING_BOUNCY:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",SPRING_SMOOTH:"cubic-bezier(0.4, 0, 0.2, 1)",MANIFEST_URL:"https://OofMini.github.io/Minis-Repo/mini.json",BASE_URL:V?window.location.origin+window.location.pathname:"https://OofMini.github.io/Minis-Repo/"},K=document.createElement("div");function E(t){return t?(K.textContent=t,K.innerHTML):""}function y(t){return t?String(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}const me="#a78bfa";function fe(t){return t&&/^#[0-9A-Fa-f]{6}$/.test(t)?t:me}function A(t,e){if(!t||t.length<7)return`rgba(167, 139, 250, ${e})`;const r=parseInt(t.slice(1,3),16),n=parseInt(t.slice(3,5),16),o=parseInt(t.slice(5,7),16);return isNaN(r)||isNaN(n)||isNaN(o)?`rgba(167, 139, 250, ${e})`:`rgba(${r}, ${n}, ${o}, ${e})`}function ge(t){return!t||typeof t!="number"?"Unknown":t>=1073741824?`${(t/1073741824).toFixed(1)} GB`:`${(t/1048576).toFixed(0)} MB`}function ve(t){if(!t)return"";const e=new Date(t+"T00:00:00Z"),n=Date.now()-e.getTime(),o=Math.floor(n/864e5);return o<0?"Just now":o===0?"Today":o===1?"Yesterday":o<7?`${o}d ago`:o<30?`${Math.floor(o/7)}w ago`:o<365?`${Math.floor(o/30)}mo ago`:`${Math.floor(o/365)}y ago`}function ye(t){const e=t.toLowerCase();return e.includes("youtubemusic")||e.includes("spotify")||e.includes("music")?"Music":e.includes("youtube")||e.includes("video")?"Video":e.includes("social")||e.includes("tweet")||e.includes("twitter")?"Social":e.includes("editor")||e.includes("inshot")||e.includes("photo")||e.includes("reface")||e.includes("doublicatapp")?"Creative":"Utilities"}function we(t,e){return t?t.toLowerCase():`unknown-${e}`}function be(t){if(!t||typeof t!="string")return!1;try{const e=new URL(t);return e.protocol==="https:"&&e.hostname.length>0}catch{return!1}}function Ee(t,e){let r;return(...n)=>{clearTimeout(r),r=setTimeout(()=>t(...n),e)}}function Ce(t,e){return new Promise(r=>{try{const n=indexedDB.open("minis-repo",1);n.onupgradeneeded=()=>{const o=n.result;o.objectStoreNames.contains("searches")||o.createObjectStore("searches",{keyPath:"key"}),o.objectStoreNames.contains("data")||o.createObjectStore("data",{keyPath:"key"})},n.onsuccess=()=>{try{const s=n.result.transaction(t,"readonly").objectStore(t).get(e);s.onsuccess=()=>r(s.result?.value),s.onerror=()=>r(void 0)}catch{r(void 0)}},n.onerror=()=>r(void 0)}catch{r(void 0)}})}function Ae(t,e,r){return new Promise(n=>{try{const o=indexedDB.open("minis-repo",1);o.onupgradeneeded=()=>{const i=o.result;i.objectStoreNames.contains("searches")||i.createObjectStore("searches",{keyPath:"key"}),i.objectStoreNames.contains("data")||i.createObjectStore("data",{keyPath:"key"})},o.onsuccess=()=>{try{const i=o.result.transaction(t,"readwrite");i.objectStore(t).put({key:e,value:r}),i.oncomplete=()=>n(),i.onerror=()=>n()}catch{n()}},o.onerror=()=>n()}catch{n()}})}function Le(t){return Array.isArray(t)?t.map(e=>typeof e=="string"?{type:e,usageDescription:""}:typeof e=="object"&&e!==null&&"type"in e?{type:e.type,usageDescription:e.usageDescription??""}:null).filter(e=>e!==null):[]}function P(t,e,r,n){if(!e)return{score:0,ranges:[]};if(e===t)return{score:1*r,ranges:[[0,e.length]]};if(e.startsWith(t))return{score:.95*r,ranges:[[0,t.length]]};const o=e.indexOf(t);if(o>=0)return{score:(.8+(o===0||/\W/.test(e[o-1])?.05:0))*r,ranges:[[o,o+t.length]]};const i=n??R(e),s=Ie(t,e,i);if(s)return{score:.65*r,ranges:s};const c=Se(t,e);if(c){const l=c[c.length-1][1]-c[0][0],d=t.length/Math.max(l,1);return{score:Math.min(.5,.3+d*.2)*r,ranges:c}}return{score:0,ranges:[]}}function R(t){const e=[0];for(let r=1;r<t.length;r++)/\W/.test(t[r-1])&&/\w/.test(t[r])&&e.push(r);return e}function Ie(t,e,r){if(r.length<t.length)return null;const n=[];let o=0;for(let i=0;i<t.length;i++){let s=!1;for(;o<r.length;){if(e[r[o]]===t[i]){n.push([r[o],r[o]+1]),o++,s=!0;break}o++}if(!s)return null}return n}function Se(t,e){const r=[];let n=0;for(let o=0;o<t.length;o++){let i=!1;for(;n<e.length;){if(e[n]===t[o]){r.length>0&&r[r.length-1][1]===n?r[r.length-1][1]=n+1:r.push([n,n+1]),n++,i=!0;break}n++}if(!i)return null}return r}function ke(t,e){const r=t.toLowerCase().trim();if(!r)return e.map(o=>({app:o,score:1,nameMatches:[]}));const n=[];for(const o of e){const i=P(r,o._searchName,1,o._wordStartsName),s=P(r,o._searchDev,.7,o._wordStartsDev),c=P(r,o._searchDesc,.4,o._wordStartsDesc);let l=0,d=[];i.score>=s.score&&i.score>=c.score?(l=i.score,d=i.ranges):s.score>=c.score?(l=s.score,d=[]):(l=c.score,d=[]),l>0&&n.push({app:o,score:l,nameMatches:i.score>0?i.ranges:d})}return n.sort((o,i)=>i.score!==o.score?i.score-o.score:o.app.name.localeCompare(i.app.name)),n}function Te(t,e){if(!e.length)return T(t);let r="",n=0;const o=[...e].sort((s,c)=>s[0]-c[0]),i=[];for(const s of o)i.length>0&&s[0]<=i[i.length-1][1]?i[i.length-1][1]=Math.max(i[i.length-1][1],s[1]):i.push([...s]);for(const[s,c]of i)n<s&&(r+=T(t.slice(n,s))),r+=`<mark>${T(t.slice(s,c))}</mark>`,n=c;return n<t.length&&(r+=T(t.slice(n))),r}function T(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}class xe{constructor(e,r){this.items=[],this.pool=[],this.activeNodes=new Map,this.columns=1,this.rowHeight=m.CARD_ROW_HEIGHT,this.gap=m.CARD_GAP,this.containerTop=0,this.rafId=0,this.resizeObserver=null,this.resizeRafId=0,this.cachedPaddingLeft=0,this.cachedPaddingRight=0,this.cachedContainerWidth=0,this.cachedAvailableWidth=0,this.cachedColWidth=0,this.container=e,this.callbacks=r,this.innerContainer=document.createElement("div"),this.innerContainer.className="vs-inner",this.innerContainer.setAttribute("role","list"),this.innerContainer.setAttribute("aria-label","App list"),this.container.appendChild(this.innerContainer);for(let n=0;n<m.CARD_POOL_SIZE;n++){const o=r.createCardNode();o.style.position="absolute",o.style.left="0",o.style.top="0",o.style.display="none",o.setAttribute("role","listitem"),this.innerContainer.appendChild(o),this.pool.push({el:o,appId:null})}this.setupListeners(),this.computeLayout()}setupListeners(){const e=()=>{this.rafId||(this.rafId=requestAnimationFrame(()=>{this.rafId=0,this.render()}))};window.addEventListener("scroll",e,{passive:!0}),this.resizeObserver=new ResizeObserver(()=>{this.resizeRafId&&cancelAnimationFrame(this.resizeRafId),this.resizeRafId=requestAnimationFrame(()=>{this.resizeRafId=0,this.computeLayout(),this.render()})}),this.resizeObserver.observe(this.container),this.innerContainer.addEventListener("click",r=>{const n=r.target.closest("[data-app-id]");if(!n||r.target.closest("button"))return;const i=n.dataset.appId;i&&this.callbacks.onCardClick(i)}),this.innerContainer.addEventListener("keydown",r=>{const n=r.target.closest("[data-app-id]");if(n){if(r.key==="Enter"||r.key===" "){r.preventDefault();const o=n.dataset.appId;o&&this.callbacks.onCardClick(o);return}["ArrowRight","ArrowLeft","ArrowDown","ArrowUp"].includes(r.key)&&(r.preventDefault(),this.navigateGrid(n,r.key))}})}navigateGrid(e,r){const n=e.dataset.appId;if(!n)return;const o=this.items.findIndex(s=>s.id===n);if(o===-1)return;let i=o;switch(r){case"ArrowRight":i=Math.min(o+1,this.items.length-1);break;case"ArrowLeft":i=Math.max(o-1,0);break;case"ArrowDown":i=Math.min(o+this.columns,this.items.length-1);break;case"ArrowUp":i=Math.max(o-this.columns,0);break}if(i!==o){const s=this.items[i];this.scrollToIndex(i),requestAnimationFrame(()=>{const c=this.activeNodes.get(s.id);c&&c.el.focus({preventScroll:!1})})}}computeLayout(){const e=getComputedStyle(this.container);this.cachedContainerWidth=this.container.clientWidth,this.cachedPaddingLeft=parseFloat(e.paddingLeft)||0,this.cachedPaddingRight=parseFloat(e.paddingRight)||0,this.cachedAvailableWidth=this.cachedContainerWidth-this.cachedPaddingLeft-this.cachedPaddingRight,this.cachedAvailableWidth>=900?this.columns=3:this.cachedAvailableWidth>=540?this.columns=2:this.columns=1;const r=e.getPropertyValue("--vs-gap")?.trim();r&&(this.gap=parseInt(r,10)||m.CARD_GAP),this.cachedColWidth=(this.cachedAvailableWidth-(this.columns-1)*this.gap)/this.columns,this.containerTop=this.container.getBoundingClientRect().top+window.scrollY}setItems(e){this.items=e;const n=Math.ceil(e.length/this.columns)*(this.rowHeight+this.gap)-this.gap;this.innerContainer.style.height=`${Math.max(n,0)}px`;for(const[o,i]of this.activeNodes)i.el.style.display="none",i.appId=null,this.pool.push(i),this.activeNodes.delete(o);this.render()}acquireNode(){if(this.pool.length>0)return this.pool.pop()}releaseNode(e){e.appId&&this.activeNodes.delete(e.appId),e.el.style.display="none",e.appId=null,this.pool.push(e)}render(){if(this.items.length===0){for(const[,h]of this.activeNodes)this.releaseNode(h);return}const e=window.scrollY,r=window.innerHeight,n=r*2,o=this.containerTop,i=this.rowHeight+this.gap,s=Math.ceil(this.items.length/this.columns),c=e-o-n,l=e+r-o+n,d=Math.max(0,Math.floor(c/i)),p=Math.min(s-1,Math.ceil(l/i)),f=d*this.columns,g=Math.min((p+1)*this.columns,this.items.length),v=new Set;for(let h=f;h<g;h++)v.add(this.items[h].id);for(const[h,I]of this.activeNodes)v.has(h)||this.releaseNode(I);const b=this.cachedPaddingLeft,u=this.cachedColWidth;for(let h=f;h<g;h++){const I=this.items[h];let C=this.activeNodes.get(I.id);if(!C){if(C=this.acquireNode(),!C)continue;C.appId=I.id,this.activeNodes.set(I.id,C),this.callbacks.bindCard(C.el,I,h)}const de=Math.floor(h/this.columns),ue=h%this.columns,he=b+ue*(u+this.gap),pe=de*i;C.el.style.transform=`translate3d(${he}px, ${pe}px, 0)`,C.el.style.width=`${u}px`,C.el.style.height=`${this.rowHeight}px`,C.el.style.display=""}}scrollToIndex(e){const r=Math.floor(e/this.columns),n=this.rowHeight+this.gap,o=this.containerTop+r*n,i=window.innerHeight;(o<window.scrollY||o+this.rowHeight>window.scrollY+i)&&window.scrollTo({top:o-i/3,behavior:"smooth"}),requestAnimationFrame(()=>this.render())}setRowHeight(e){if(e>0&&e!==this.rowHeight){this.rowHeight=e;const n=Math.ceil(this.items.length/this.columns)*(this.rowHeight+this.gap)-this.gap;this.innerContainer.style.height=`${Math.max(n,0)}px`,this.render()}}getActiveNodeCount(){return this.activeNodes.size}destroy(){this.rafId&&cancelAnimationFrame(this.rafId),this.resizeRafId&&cancelAnimationFrame(this.resizeRafId),this.resizeObserver?.disconnect(),this.innerContainer.remove()}}let N=null,L=null,O=[],G=!1;function ne(){return N||(N=document.getElementById("toast")),N}function w(t,e="info",r){const n=ne();if(n){if(G){O.push({msg:t,type:e,action:r}),O.length>2&&q();return}oe(n,t,e,r)}}function oe(t,e,r,n){G=!0,L&&(clearTimeout(L),L=null),t.innerHTML="";const o=document.createElement("span");if(o.textContent=e,t.appendChild(o),n){const i=document.createElement("button");i.type="button",i.textContent=n.text,i.addEventListener("click",()=>{n.callback(),q()}),t.appendChild(i)}t.setAttribute("aria-live",r==="error"||r==="warning"?"assertive":"polite"),t.className=`toast ${r} show`,L=setTimeout(()=>{q()},m.TOAST_DURATION)}function q(){const t=ne();if(t&&(t.classList.remove("show"),G=!1,L&&(clearTimeout(L),L=null),O.length>0)){const e=O.shift();setTimeout(()=>{oe(t,e.msg,e.type,e.action)},300)}}function Re(){const t=document.createElement("article");return t.className="app-card",t.tabIndex=0,t.innerHTML=`
        <div class="card-accent" aria-hidden="true"></div>
        <div class="card-body">
            <div class="card-icon-wrap">
                <img class="card-icon" width="64" height="64" loading="lazy" decoding="async" alt="">
                <span class="card-version-badge" aria-hidden="true"></span>
            </div>
            <div class="card-info">
                <h3 class="card-name"></h3>
                <p class="card-developer"></p>
                <p class="card-meta"></p>
            </div>
            <button type="button" class="card-get-btn" aria-label="">
                <span class="card-get-text">GET</span>
                <span class="card-get-spinner" aria-hidden="true"></span>
                <span class="card-get-check" aria-hidden="true"></span>
            </button>
        </div>
        <div class="card-separator" aria-hidden="true"></div>
    `,t}function Me(t,e,r,n){t.dataset.appId=e.id,t.setAttribute("aria-label",`${e.name} by ${e.developer} — tap to view details`),t.style.setProperty("--tint",e.tintColor),t.style.setProperty("--tint-10",A(e.tintColor,.1)),t.style.setProperty("--tint-20",A(e.tintColor,.2)),t.style.setProperty("--tint-40",A(e.tintColor,.4));const o=t.querySelector(".card-accent");o&&(o.style.backgroundColor=e.tintColor);const i=t.querySelector(".card-icon");i&&i.src!==e.icon&&!i.src.endsWith(e.icon)&&(i.src=e.icon,i.alt=`${e.name} icon`,i.onerror=()=>{i.src=m.FALLBACK_ICON});const s=t.querySelector(".card-version-badge");s&&(s.textContent=`v${e.version}`);const c=t.querySelector(".card-name");c&&(n&&n.length>0?c.innerHTML=Te(e.name,n):c.textContent=e.name);const l=t.querySelector(".card-developer");l&&(l.textContent=e.developer);const d=t.querySelector(".card-meta");d&&(d.textContent=`${e.size} · ${ve(e.date)}`);const p=t.querySelector(".card-get-btn");if(p){p.dataset.id=e.id,p.setAttribute("aria-label",`Download ${e.name}`),p.className="card-get-btn",p.style.setProperty("--btn-tint",e.tintColor),p.style.setProperty("--btn-tint-bg",A(e.tintColor,.12));const f=p.querySelector(".card-get-text");f&&(f.style.display="");const g=p.querySelector(".card-get-spinner");g&&(g.style.display="none");const v=p.querySelector(".card-get-check");v&&(v.style.display="none")}}function j(t,e,r){const n=e.find(s=>s.id===t);if(!n)return;if(!r){w("You are offline. Downloads require a connection.","warning");return}if(!be(n.downloadUrl)){w("Security Block: URL must be HTTPS","error");return}const o=document.querySelector(`.card-get-btn[data-id="${CSS.escape(t)}"]`);o&&Be(o);const i=document.createElement("a");i.href=n.downloadUrl,i.target="_blank",i.rel="noopener noreferrer",i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),w(`Downloading ${n.name}`,"success")}function Be(t){const e=t.querySelector(".card-get-text"),r=t.querySelector(".card-get-spinner"),n=t.querySelector(".card-get-check");!e||!r||!n||(t.classList.add("downloading"),e.style.display="none",r.style.display="",setTimeout(()=>{r.style.display="none",n.style.display="",t.classList.remove("downloading"),t.classList.add("downloaded"),setTimeout(()=>{t.classList.remove("downloaded"),e.style.display="",n.style.display="none"},2e3)},800))}function Oe(t,e,r,n){const o=r.querySelector(".featured-icon"),i=r.querySelector(".featured-name"),s=r.querySelector(".featured-dev"),c=r.querySelector(".featured-desc"),l=r.querySelector(".featured-get-btn");o&&(o.src=t.icon,o.alt=`${t.name} icon`,o.onerror=()=>{o.src=m.FALLBACK_ICON}),i&&(i.textContent=t.name),s&&(s.textContent=t.developer),c&&(c.textContent=t.description),l&&(l.dataset.id=t.id,l.setAttribute("aria-label",`Download ${t.name}`),l.style.setProperty("--btn-tint",t.tintColor)),r.style.setProperty("--tint",t.tintColor),r.style.setProperty("--tint-10",A(t.tintColor,.1)),r.style.setProperty("--tint-20",A(t.tintColor,.2)),r.setAttribute("data-app-id",t.id),r.setAttribute("aria-label",`${t.name} — featured app, tap to view details`),e.removeAttribute("hidden"),e.classList.add("visible"),r.addEventListener("click",d=>{d.target.closest("button")||n(t.id)}),r.addEventListener("keydown",d=>{(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),n(t.id))})}function _e(t){const e=document.createElement("link");e.rel="preconnect",e.href="https://objects.githubusercontent.com",e.crossOrigin="anonymous",document.head.appendChild(e);const r=Math.min(6,t.length);for(let n=0;n<r;n++){const o=document.createElement("link");o.rel="preload",o.as="image",o.href=t[n].icon,n<3&&o.setAttribute("fetchpriority","high"),document.head.appendChild(o)}}let _=null,$=null;function D(t,e,r=!1){const n=e.apps.find(u=>u.id===t);if(!n||e.modalOpen)return;e.modalOpen=!0,e.modalScrollY=window.scrollY,e.lastOpenedCardId=t,Ne(n),_?.remove(),re(n.bundleId,r,e);const o=document.getElementById("themeColor");o&&(o.content="#0a0a0f");const i=document.createElement("div");i.id="appModal",i.className="modal-overlay",i.setAttribute("role","dialog"),i.setAttribute("aria-modal","true"),i.setAttribute("aria-label",`${n.name} details`);const s=n.screenshots.length>0?`<div class="modal-screenshots" role="region" aria-label="Screenshots">
                <div class="modal-screenshots-track">
                    ${n.screenshots.map((u,h)=>`<img src="${y(u)}" alt="${y(n.name)} screenshot ${h+1}" loading="eager" decoding="async" class="modal-screenshot" data-idx="${h}">`).join("")}
                </div>
                <div class="modal-dots" aria-hidden="true">
                    ${n.screenshots.map((u,h)=>`<span class="modal-dot${h===0?" active":""}"></span>`).join("")}
                </div>
            </div>`:"",c=n.permissions.length>0?`<div class="modal-permissions">
                <span class="modal-permissions-label">Permissions:</span>
                ${n.permissions.map(u=>`<span class="modal-perm-tag" title="${y(u.usageDescription)}">${E(u.type)}</span>`).join("")}
            </div>`:"",l=n.changelog?`<div class="modal-changelog">
            <strong>What's New</strong>
            <p>${E(n.changelog)}</p>
        </div>`:"",d=(e.developerIndex?.get(n.developer)??[]).filter(u=>u.id!==n.id),p=d.length>0?`<div class="modal-more-section">
                <h4>More by ${E(n.developer)}</h4>
                <div class="modal-more-row">
                    ${d.map(u=>`<button type="button" class="modal-more-item" data-app-id="${y(u.id)}" aria-label="View ${y(u.name)}">
                            <img src="${y(u.icon)}" alt="" width="48" height="48" loading="lazy" decoding="async" class="modal-more-icon">
                            <span class="modal-more-name">${E(u.name)}</span>
                        </button>`).join("")}
                </div>
            </div>`:"";i.innerHTML=`
        <div class="modal-backdrop"></div>
        <div class="modal-content" role="document">
            <div class="modal-drag-handle" aria-hidden="true"></div>
            <button type="button" class="modal-close" aria-label="Close dialog">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M4 4l8 8M12 4l-8 8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            </button>
            <div class="modal-header">
                <div class="modal-icon-container">
                    <img src="${y(n.icon)}" alt="${y(n.name)} icon"
                         class="modal-icon" width="88" height="88">
                </div>
                <div class="modal-title-block">
                    <h2 class="modal-title">${E(n.name)}</h2>
                    <p class="modal-developer">${E(n.developer)}</p>
                    <div class="modal-meta">
                        <span class="modal-meta-item">v${E(n.version)}</span>
                        <span class="modal-meta-sep" aria-hidden="true">&bull;</span>
                        <span class="modal-meta-item">${E(n.size)}</span>
                        <span class="modal-meta-sep" aria-hidden="true">&bull;</span>
                        <span class="modal-meta-item">iOS ${E(n.minimumOS)}+</span>
                    </div>
                </div>
            </div>
            ${s}
            <div class="modal-body">
                <p class="modal-description">${E(n.description)}</p>
                ${l}
                ${c}
                <p class="modal-date">Updated ${E(n.date)}</p>
            </div>
            ${p}
            <div class="modal-footer">
                <div class="modal-action-row">
                    ${"share"in navigator?`<button type="button" class="modal-action-btn modal-share-btn" aria-label="Share ${y(n.name)}">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M8 2v8M4 6l4-4 4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M2 10v3a1 1 0 001 1h10a1 1 0 001-1v-3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
                        Share
                    </button>`:""}
                    <button type="button" class="modal-action-btn modal-copy-btn" aria-label="Copy link to ${y(n.name)}">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M6 6H4a2 2 0 00-2 2v4a2 2 0 002 2h4a2 2 0 002-2v-2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><rect x="6" y="2" width="8" height="8" rx="2" stroke="currentColor" stroke-width="1.5"/></svg>
                        Copy Link
                    </button>
                </div>
                <button type="button" class="modal-download-btn" data-id="${y(n.id)}" aria-label="Download ${y(n.name)} IPA">
                    Download IPA
                </button>
            </div>
        </div>
    `,document.body.appendChild(i),_=i;const f=i.querySelector(".modal-content");f&&(f.style.setProperty("--modal-tint",n.tintColor),f.style.setProperty("--modal-tint-glow",A(n.tintColor,.12)));const g=i.querySelector(".modal-icon");g&&g.addEventListener("error",()=>{g.src=m.FALLBACK_ICON},{once:!0}),i.querySelectorAll(".modal-screenshot").forEach(u=>{u.addEventListener("error",()=>{u.style.display="none"},{once:!0})}),document.body.classList.add("modal-open"),document.body.style.top=`-${e.modalScrollY}px`,i.offsetHeight,i.classList.add("active");const v=i.querySelector(".modal-close");v?.focus(),De(i),$?.(),$=Pe(i),i.querySelector(".modal-backdrop")?.addEventListener("click",()=>S(!1,e)),v?.addEventListener("click",()=>S(!1,e)),i.querySelector(".modal-download-btn")?.addEventListener("click",()=>{j(n.id,e.apps,e.isOnline)}),i.querySelector(".modal-share-btn")?.addEventListener("click",async()=>{const u=`${m.BASE_URL}#app-${encodeURIComponent(n.bundleId)}`;try{await navigator.share({title:`${n.name} — Mini's Repo`,text:`Get ${n.name} (v${n.version}) from Mini's IPA Repo`,url:u})}catch(h){h.name!=="AbortError"&&w("Share failed","warning")}});const b=i.querySelector(".modal-copy-btn");b?.addEventListener("click",async()=>{const u=`${m.BASE_URL}#app-${encodeURIComponent(n.bundleId)}`;let h=!1;try{await navigator.clipboard.writeText(u),h=!0}catch{h=Ue(u)}h?(b.classList.add("copied"),b.innerHTML='<svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M3 8l3 3 7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> Copied!',w("Link copied to clipboard","success"),setTimeout(()=>{b.classList.remove("copied"),b.innerHTML='<svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M6 6H4a2 2 0 00-2 2v4a2 2 0 002 2h4a2 2 0 002-2v-2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/><rect x="6" y="2" width="8" height="8" rx="2" stroke="currentColor" stroke-width="1.5"/></svg> Copy Link'},2e3)):w("Failed to copy link","warning")}),i.querySelectorAll(".modal-more-item").forEach(u=>{u.addEventListener("click",()=>{const h=u.dataset.appId;h&&(S(!1,e),setTimeout(()=>D(h,e),400))})}),i.addEventListener("keydown",u=>{if(u.key==="Escape"){u.stopPropagation(),S(!1,e);return}u.key==="Tab"&&He(u,i)})}function S(t,e){const r=_;if(!r||!e.modalOpen)return;e.modalOpen=!1,$?.(),$=null,r.classList.remove("active");const n=document.getElementById("themeColor");n&&(n.content="#000000"),document.body.classList.remove("modal-open"),document.body.style.top="",window.scrollTo({top:e.modalScrollY,behavior:"instant"}),!t&&e.modalHistoryPushed?(e.modalHistoryPushed=!1,history.back()):(e.modalHistoryPushed=!1,re(null,!1,e));const o=e.lastOpenedCardId;e.lastOpenedCardId=null,setTimeout(()=>{r.remove(),_=null},350),o&&document.querySelector(`.app-card[data-app-id="${CSS.escape(o)}"]`)?.focus({preventScroll:!0})}function re(t,e,r){if(t){const n=`#app-${encodeURIComponent(t)}`;e?(history.replaceState({appModal:!0},"",n),r.modalHistoryPushed=!1):(history.pushState({appModal:!0},"",n),r.modalHistoryPushed=!0)}else history.replaceState(null,"",window.location.pathname+window.location.search)}function ie(t){const e=window.location.hash;if(e&&e.startsWith("#app-")){const r=decodeURIComponent(e.substring(5)),n=t.apps.find(o=>o.bundleId===r||o.id===r);n&&setTimeout(()=>D(n.id,t,!0),100)}}function $e(t){window.addEventListener("popstate",()=>{t.modalOpen&&!window.location.hash?(t.modalHistoryPushed=!1,S(!0,t)):window.location.hash?.startsWith("#app-")&&ie(t)})}function De(t){const e=t.querySelector(".modal-screenshots-track"),r=t.querySelectorAll(".modal-dot");if(!e||r.length===0)return;const n=e.parentElement;if(!n)return;n.setAttribute("tabindex","0"),n.setAttribute("role","listbox"),n.setAttribute("aria-label","Screenshot carousel, use arrow keys to navigate");let o=0;const i=s=>{o=s,r.forEach((c,l)=>{c.classList.toggle("active",l===o)})};n.addEventListener("scroll",()=>{const s=n.scrollLeft,c=e.querySelectorAll(".modal-screenshot");if(c.length===0)return;const l=c[0].offsetWidth+12,d=Math.round(s/l);d!==o&&i(d)},{passive:!0}),n.addEventListener("keydown",s=>{if(s.key!=="ArrowLeft"&&s.key!=="ArrowRight")return;s.preventDefault();const c=e.querySelectorAll(".modal-screenshot");if(c.length===0)return;const l=c[0].offsetWidth+12;s.key==="ArrowRight"?o=Math.min(o+1,c.length-1):o=Math.max(o-1,0),n.scrollTo({left:o*l,behavior:"smooth"}),i(o)})}function Pe(t){const e=t.querySelector(".modal-icon");if(!e)return null;const r=i=>{const s=e.getBoundingClientRect(),c=s.left+s.width/2,l=s.top+s.height/2,d=(i.clientX-c)/(s.width/2),f=(i.clientY-l)/(s.height/2)*-8,g=d*8;e.style.transform=`perspective(200px) rotateX(${f}deg) rotateY(${g}deg)`},n=()=>{e.style.transform=""};t.addEventListener("mousemove",r),t.addEventListener("mouseleave",n);let o=null;return"DeviceOrientationEvent"in window&&(o=i=>{const s=(i.beta??0)/90,c=(i.gamma??0)/90;e.style.transform=`perspective(200px) rotateX(${s*-10}deg) rotateY(${c*10}deg)`},window.addEventListener("deviceorientation",o,{passive:!0})),()=>{t.removeEventListener("mousemove",r),t.removeEventListener("mouseleave",n),o&&(window.removeEventListener("deviceorientation",o),o=null),e.style.transform=""}}function Ne(t){const e=[t.icon,...t.screenshots].filter(Boolean),r=new Set;document.querySelectorAll('link[rel="preload"][as="image"]').forEach(n=>{r.add(n.href)});for(const n of e){let o;try{o=new URL(n,window.location.href).href}catch{continue}if(r.has(o))continue;const i=document.createElement("link");i.rel="preload",i.as="image",i.href=n,document.head.appendChild(i),setTimeout(()=>i.remove(),3e4)}}function He(t,e){const r=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(r.length===0)return;const n=r[0],o=r[r.length-1];t.shiftKey&&document.activeElement===n?(t.preventDefault(),o.focus()):!t.shiftKey&&document.activeElement===o&&(t.preventDefault(),n.focus())}function Ue(t){try{const e=document.createElement("textarea");e.value=t,e.style.cssText="position:fixed;left:-9999px;opacity:0",document.body.appendChild(e),e.select();const r=document.execCommand("copy");return document.body.removeChild(e),r}catch{return!1}}const qe=`
attribute vec2 a_pos;
void main() { gl_Position = vec4(a_pos, 0.0, 1.0); }
`,Fe=`
precision mediump float;
uniform float u_time;
uniform vec2 u_res;

vec3 pal(float t) {
    vec3 a = vec3(0.486, 0.227, 0.918);
    vec3 b = vec3(0.165, 0.118, 0.353);
    vec3 c = vec3(0.659, 0.333, 0.969);
    return a + b * cos(6.283 * (c * t + vec3(0.0, 0.33, 0.67)));
}

float hash(vec2 p) {
    return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453);
}

float noise(vec2 p) {
    vec2 i = floor(p);
    vec2 f = fract(p);
    f = f * f * (3.0 - 2.0 * f);
    return mix(
        mix(hash(i), hash(i + vec2(1.0, 0.0)), f.x),
        mix(hash(i + vec2(0.0, 1.0)), hash(i + vec2(1.0, 1.0)), f.x),
        f.y
    );
}

void main() {
    vec2 uv = gl_FragCoord.xy / u_res;
    float t = u_time * 0.08;
    float n = noise(uv * 3.0 + t);
    vec3 c1 = pal(uv.x * 0.4 + n * 0.3 + t);
    vec3 c2 = pal(length(uv - 0.5) * 0.6 + t * 0.7);
    vec3 col = mix(c1, c2, n * 0.5 + 0.25);
    float fade = smoothstep(1.2, 0.0, length(uv - vec2(0.5, 0.3)) * 1.5);
    gl_FragColor = vec4(col * fade * 0.3, 1.0);
}
`;function We(t){const e=t.getContext("webgl",{alpha:!1,antialias:!1,powerPreference:"low-power"});if(!e)return null;const r=X(e,e.VERTEX_SHADER,qe),n=X(e,e.FRAGMENT_SHADER,Fe);if(!r||!n)return null;const o=e.createProgram();if(e.attachShader(o,r),e.attachShader(o,n),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))return console.warn("[HeroGL] Link failed:",e.getProgramInfoLog(o)),null;e.useProgram(o);const i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,1]),e.STATIC_DRAW);const s=e.getAttribLocation(o,"a_pos");e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0);const c=e.getUniformLocation(o,"u_time"),l=e.getUniformLocation(o,"u_res");let d=!0,p=0;function f(){const v=Math.min(window.devicePixelRatio,1.5),b=t.clientWidth*v,u=t.clientHeight*v;(t.width!==b||t.height!==u)&&(t.width=b,t.height=u,e.viewport(0,0,b,u))}function g(v){d&&(p++,p%2===0&&(f(),e.uniform1f(c,v*.001),e.uniform2f(l,t.width,t.height),e.drawArrays(e.TRIANGLE_STRIP,0,4)),requestAnimationFrame(g))}return f(),requestAnimationFrame(g),()=>{d=!1,e.deleteProgram(o),e.deleteShader(r),e.deleteShader(n),e.deleteBuffer(i)}}function X(t,e,r){const n=t.createShader(e);return t.shaderSource(n,r),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(console.warn("[HeroGL] Shader error:",t.getShaderInfoLog(n)),t.deleteShader(n),null)}let M=null,F=null;function ze(t,e){if(!("serviceWorker"in navigator))return;const r=()=>{navigator.serviceWorker.register("./sw.js").then(o=>{o.addEventListener("updatefound",()=>{M=o.installing,M?.addEventListener("statechange",()=>{M?.state==="installed"&&navigator.serviceWorker.controller&&Ge()})}),F=setInterval(()=>{o.update().catch(()=>{})},m.SW_UPDATE_INTERVAL),"sync"in o&&o.sync.register("sync-data").catch(()=>{})}).catch(o=>console.error("SW registration failed:",o))};document.readyState==="complete"?r():window.addEventListener("load",r,{once:!0});let n=!1;navigator.serviceWorker.addEventListener("controllerchange",()=>{n||(n=!0,window.location.reload())}),navigator.serviceWorker.addEventListener("message",o=>{o.data?.type==="DATA_UPDATED"&&e()})}function Ge(){w("New version available!","info",{text:"REFRESH",callback:()=>{M?.postMessage({action:"skipWaiting"})}})}function je(t){window.addEventListener("beforeinstallprompt",n=>{n.preventDefault(),t.deferredInstallPrompt=n,Ye()}),window.addEventListener("appinstalled",()=>{t.deferredInstallPrompt=null,W(),w("App installed successfully!","success");try{const n=parseInt(localStorage.getItem("install_count")??"0",10);localStorage.setItem("install_count",String(n+1)),localStorage.setItem("installed_at",new Date().toISOString())}catch{}}),window.matchMedia("(display-mode: standalone)").matches&&document.body.classList.add("pwa-installed"),document.getElementById("btn-install")?.addEventListener("click",Ve),document.getElementById("btn-install-dismiss")?.addEventListener("click",W)}function Ye(){const t=document.getElementById("installBanner");t&&(t.removeAttribute("hidden"),requestAnimationFrame(()=>requestAnimationFrame(()=>t.classList.add("visible"))))}function W(){const t=document.getElementById("installBanner");t&&(t.classList.remove("visible"),setTimeout(()=>t.setAttribute("hidden",""),400))}async function Ve(){const t=window.__state?.deferredInstallPrompt;t&&(t.prompt(),await t.userChoice,W())}function Ke(t){const e=document.getElementById("offlineBar");function r(){t.isOnline=navigator.onLine,e&&(t.isOnline?(e.classList.remove("visible"),setTimeout(()=>e.setAttribute("hidden",""),350)):(e.removeAttribute("hidden"),requestAnimationFrame(()=>requestAnimationFrame(()=>e.classList.add("visible"))))),document.querySelectorAll(".card-get-btn").forEach(n=>{n.classList.toggle("offline-disabled",!t.isOnline)})}window.addEventListener("online",()=>{r(),w("Back online","success")},{passive:!0}),window.addEventListener("offline",()=>{r(),w("You are offline","warning")},{passive:!0}),r()}function Xe(t){if(!("setAppBadge"in navigator))return;const e=Date.now(),r=1440*60*1e3,n=t.filter(o=>{const i=new Date(o.date+"T00:00:00Z").getTime();return e-i<r}).length;n>0?navigator.setAppBadge(n).catch(()=>{}):navigator.clearAppBadge?.().catch(()=>{})}function Ze(){F&&clearInterval(F)}async function Je(){try{if(localStorage.clear(),"caches"in window){const t=await caches.keys();await Promise.all(t.map(e=>caches.delete(e)))}indexedDB.deleteDatabase("minis-repo")}catch{}window.location.reload()}const a={apps:[],filteredApps:[],searchTerm:"",activeCategory:"all",sortMode:"recent",isLoading:!0,isOnline:navigator.onLine,modalOpen:!1,modalScrollY:0,lastOpenedCardId:null,modalHistoryPushed:!1,deferredInstallPrompt:null,toastTimer:null,renderGeneration:0,recentSearches:[],searchOverlayOpen:!1,developerIndex:new Map};window.__state=a;let Y=null,z=null,B=[],Z="",J="all",Q="recent";document.addEventListener("DOMContentLoaded",async()=>{try{lt(),dt(),ze(a,at),je(a),Ke(a),$e(a),it(),(window.requestIdleCallback??(r=>setTimeout(r,0)))(()=>nt());const e=await Ce("searches","recent");e&&(a.recentSearches=e),a.apps=await se(),a.isLoading=!1,ae(),a.apps.length===0?ee("No apps available in this repository"):(le(a.apps.length),tt(),ce(),_e(a.apps),et(),k(!0),ie(a),Xe(a.apps),rt())}catch(t){console.error("Initialization error:",t),ee(t.message??"Failed to initialize")}});async function se(){const t=new AbortController,e=setTimeout(()=>t.abort(),m.FETCH_TIMEOUT),r=document.getElementById("appGrid");r&&r.setAttribute("aria-busy","true");try{const n=await fetch(m.API_ENDPOINT,{signal:t.signal,cache:"no-cache"});if(clearTimeout(e),!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);let o;try{o=await n.json()}catch{throw new Error("Data corruption: Unable to parse app manifest.")}if(!o?.apps||!Array.isArray(o.apps))throw new Error("Invalid manifest structure");return o.apps.filter(i=>i.versions?.length>0).map((i,s)=>{const c=i.versions[0],l=ye(i.bundleIdentifier??"");return{id:we(i.bundleIdentifier,s),name:i.name??"Unknown App",bundleId:i.bundleIdentifier??"",developer:i.developerName??"Unknown",description:i.localizedDescription??"",icon:i.iconURL??m.FALLBACK_ICON,version:c.version??"Unknown",date:c.date??"",downloadUrl:c.downloadURL??"",category:l,size:ge(c.size),sizeBytes:c.size??0,changelog:c.localizedDescription??"",tintColor:fe(i.tintColor),subtitle:i.subtitle??"",minimumOS:c.minOSVersion??"15.0",permissions:Le(i.permissions??[]),screenshots:i.screenshotURLs??[],_searchName:(i.name??"").toLowerCase(),_searchDev:(i.developerName??"").toLowerCase(),_searchDesc:(i.localizedDescription??"").toLowerCase(),_wordStartsName:R((i.name??"").toLowerCase()),_wordStartsDev:R((i.developerName??"").toLowerCase()),_wordStartsDesc:R((i.localizedDescription??"").toLowerCase())}})}catch(n){throw n.name==="AbortError"?new Error("Request timeout — please check your connection"):n}finally{clearTimeout(e),r&&r.removeAttribute("aria-busy")}}function ae(){a.developerIndex=new Map;for(const t of a.apps){const e=a.developerIndex.get(t.developer);e?e.push(t):a.developerIndex.set(t.developer,[t])}}function k(t=!1){!t&&a.searchTerm===Z&&a.activeCategory===J&&a.sortMode===Q||(Z=a.searchTerm,J=a.activeCategory,Q=a.sortMode,a.renderGeneration++,a.searchTerm?(B=ke(a.searchTerm,a.apps).filter(r=>a.activeCategory==="all"||r.app.category===a.activeCategory),a.filteredApps=B.map(r=>r.app)):(B=[],a.filteredApps=a.apps.filter(e=>a.activeCategory==="all"||e.category===a.activeCategory)),a.searchTerm||(a.sortMode==="alpha"?a.filteredApps.sort((e,r)=>e.name.localeCompare(r.name)):a.filteredApps.sort((e,r)=>r.date>e.date?1:r.date<e.date?-1:0)),Y?.setItems(a.filteredApps),Qe())}function Qe(){const t=document.getElementById("searchResultsCount");if(!t)return;const e=a.filteredApps.length,r=a.apps.length;!a.searchTerm&&a.activeCategory==="all"?t.textContent=`${r} apps available, showing all ${e}`:e===0?t.textContent="No apps found":t.textContent=`${r} apps available, filtered to ${e}`}function et(){const t=document.getElementById("appGrid");t&&(t.innerHTML="",Y=new xe(t,{createCardNode:Re,bindCard:(e,r,n)=>{const o=B.find(i=>i.app.id===r.id);Me(e,r,n,o?.nameMatches)},onCardClick:e=>D(e,a)}),t.addEventListener("click",e=>{const r=e.target.closest(".card-get-btn");if(r){e.stopPropagation();const n=r.dataset.id;n&&j(n,a.apps,a.isOnline)}}))}function tt(){const t=a.apps.find(o=>o.bundleId===m.FEATURED_BUNDLE_ID);if(!t)return;const e=document.getElementById("featuredSection"),r=document.getElementById("featuredCard");if(!e||!r)return;Oe(t,e,r,o=>D(o,a)),r.querySelector(".featured-get-btn")?.addEventListener("click",o=>{o.stopPropagation(),j(t.id,a.apps,a.isOnline)})}function nt(){const t=document.getElementById("heroCanvas");t&&(z=We(t),z&&t.classList.add("active"))}function ce(){const t={all:a.apps.length};for(const e of a.apps)t[e.category]=(t[e.category]||0)+1;document.querySelectorAll(".category-pill").forEach(e=>{const r=e.dataset.category;if(!r)return;const n=t[r];if(n===void 0)return;let o=e.querySelector(".category-count");o||(o=document.createElement("span"),o.className="category-count",o.setAttribute("aria-hidden","true"),e.appendChild(o)),o.textContent=String(n)})}function le(t){const e=document.getElementById("appCountText");e&&(e.textContent=`${t} Apps`)}function H(){a.searchOverlayOpen=!0;const t=document.getElementById("searchOverlay"),e=document.getElementById("searchOverlayInput");!t||!e||(t.classList.add("active"),document.body.classList.add("search-overlay-open"),e.value=a.searchTerm,e.focus(),ot())}function U(){a.searchOverlayOpen=!1;const t=document.getElementById("searchOverlay");t&&(t.classList.remove("active"),document.body.classList.remove("search-overlay-open"))}function ot(){const t=document.getElementById("recentSearches");if(t){if(a.recentSearches.length===0){t.innerHTML="";return}t.innerHTML=a.recentSearches.map(e=>`<button type="button" class="recent-search-pill" data-term="${e.replace(/"/g,"&quot;")}">${e.replace(/</g,"&lt;")}</button>`).join("")}}function x(t){!t||t.length<2||(a.recentSearches=[t,...a.recentSearches.filter(e=>e!==t)].slice(0,m.MAX_RECENT_SEARCHES),Ae("searches","recent",a.recentSearches).catch(()=>{}))}function rt(){const t=document.getElementById("scrollTopBtn"),e=document.querySelector(".hero");if(!t||!e)return;new IntersectionObserver(n=>{const o=n[0].isIntersecting;t.classList.toggle("visible",!o),t.setAttribute("aria-hidden",String(o))},{threshold:0}).observe(e),t.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})})}function it(){const t=document.getElementById("appGrid");t&&(t.setAttribute("aria-busy","true"),t.innerHTML=Array(6).fill(0).map((e,r)=>`
        <div class="skeleton-card stagger-${r%3+1}" aria-hidden="true">
            <div class="skeleton skeleton-icon"></div>
            <div class="skeleton-lines">
                <div class="skeleton skeleton-text short"></div>
                <div class="skeleton skeleton-text medium"></div>
            </div>
            <div class="skeleton skeleton-button"></div>
        </div>`).join(""))}function ee(t){const e=document.getElementById("appGrid");if(!e)return;e.removeAttribute("aria-busy"),e.innerHTML=`
        <div class="error-state">
            <div class="error-icon" aria-hidden="true">
                <svg width="48" height="48" viewBox="0 0 48 48" fill="none"><circle cx="24" cy="24" r="22" stroke="currentColor" stroke-width="2"/><path d="M24 14v12M24 32v2" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/></svg>
            </div>
            <h3>Something went wrong</h3>
            <p></p>
            <button type="button" class="retry-btn" onclick="location.reload()">Try Again</button>
        </div>
    `;const r=e.querySelector(".error-state p");r&&(r.textContent=String(t))}let te=0;const st=1e4;async function at(){const t=Date.now();if(!(t-te<st)){te=t;try{const e=await se();a.apps=e,ae(),le(e.length),ce(),k(!0),w("App list updated","info")}catch{}}}async function ct(){const t=document.getElementById("btn-copy-url"),e=document.getElementById("copyUrlLabel");try{await navigator.clipboard.writeText(m.MANIFEST_URL)}catch{const r=document.createElement("textarea");r.value=m.MANIFEST_URL,r.style.cssText="position:fixed;left:-9999px;opacity:0",document.body.appendChild(r),r.select(),document.execCommand("copy"),document.body.removeChild(r)}w("Manifest URL copied","success"),t&&e&&(e.textContent="Copied!",t.classList.add("copied"),setTimeout(()=>{e.textContent="Copy URL",t.classList.remove("copied")},2e3))}function lt(){document.getElementById("searchBox")?.addEventListener("focus",()=>H());const e=document.getElementById("searchOverlayInput");if(e){const s=Ee(c=>{a.searchTerm=c.toLowerCase().trim(),k()},m.SEARCH_DEBOUNCE);e.addEventListener("input",c=>{s(c.target.value)}),e.addEventListener("keydown",c=>{c.key==="Escape"&&(x(a.searchTerm),U()),c.key==="Enter"&&x(a.searchTerm)})}document.getElementById("searchOverlayClose")?.addEventListener("click",()=>{x(a.searchTerm),U()}),document.getElementById("searchOverlay")?.addEventListener("click",s=>{s.target===s.currentTarget&&(x(a.searchTerm),U())}),document.getElementById("recentSearches")?.addEventListener("click",s=>{const c=s.target.closest(".recent-search-pill");if(!c)return;const l=c.dataset.term??"",d=document.getElementById("searchOverlayInput");d&&(d.value=l),a.searchTerm=l.toLowerCase(),k()}),document.addEventListener("keydown",s=>{if((s.metaKey||s.ctrlKey)&&s.key==="k"){s.preventDefault(),H();return}if(s.key==="/"&&!a.modalOpen&&!a.searchOverlayOpen){const c=document.activeElement;c instanceof HTMLInputElement||c instanceof HTMLTextAreaElement||c?.isContentEditable||(s.preventDefault(),H())}s.key==="Escape"&&a.modalOpen&&S(!1,a)});const r=document.getElementById("categoryFilters");r&&(r.addEventListener("click",s=>{const c=s.target.closest(".category-pill");if(!c)return;const l=c.getBoundingClientRect(),d=document.createElement("span");d.className="pill-ripple",d.style.left=`${s.clientX-l.left}px`,d.style.top=`${s.clientY-l.top}px`,c.appendChild(d),d.addEventListener("animationend",()=>d.remove());const p=c.dataset.category;a.activeCategory=p===a.activeCategory&&p!=="all"?"all":p,r.querySelectorAll(".category-pill").forEach(f=>{const g=f.dataset.category===a.activeCategory;f.classList.toggle("active",g),f.setAttribute("aria-selected",String(g)),f.setAttribute("tabindex",g?"0":"-1")}),k()}),r.addEventListener("keydown",s=>{if(s.key==="ArrowRight"||s.key==="ArrowLeft"){s.preventDefault();const c=Array.from(r.querySelectorAll(".category-pill")),l=c.indexOf(document.activeElement);if(l===-1)return;const d=s.key==="ArrowRight"?Math.min(l+1,c.length-1):Math.max(l-1,0);c[d].focus()}}));const n=document.getElementById("sortRecent"),o=document.getElementById("sortAlpha");function i(s){a.sortMode=s,n?.classList.toggle("active",s==="recent"),n?.setAttribute("aria-pressed",String(s==="recent")),o?.classList.toggle("active",s==="alpha"),o?.setAttribute("aria-pressed",String(s==="alpha")),k()}n?.addEventListener("click",()=>i("recent")),o?.addEventListener("click",()=>i("alpha")),document.getElementById("btn-trollapps")?.addEventListener("click",()=>{window.location.href=`trollapps://add?url=${encodeURIComponent(m.API_ENDPOINT)}`}),document.getElementById("btn-sidestore")?.addEventListener("click",()=>{window.location.href=`sidestore://source?url=${encodeURIComponent(m.API_ENDPOINT)}`}),document.getElementById("btn-copy-url")?.addEventListener("click",ct),document.getElementById("btn-reset")?.addEventListener("click",async()=>{confirm("Reset all local data and cache?")&&await Je()})}function dt(){window.addEventListener("unhandledrejection",t=>console.warn("Unhandled rejection:",t.reason)),window.addEventListener("error",t=>console.error("Global error:",t.error))}window.addEventListener("beforeunload",()=>{z?.(),Y?.destroy(),Ze()});
